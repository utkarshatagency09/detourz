{{ header }}{{ column_left }}
<div id="content">
  <div class="page-header">
    <div class="container-fluid">
      <h1>{{ heading_title }}</h1>
      <ul class="breadcrumb">
        {% for breadcrumb in breadcrumbs %}
        <li><a href="{{ breadcrumb.href }}">{{ breadcrumb.text }}</a></li>
        {% endfor %}
      </ul>
    </div>
  </div>
  <div class="container-fluid">
    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title"><i class="fa fa-upload"></i> {{ text_install }}</h3>
      </div>
      <div class="panel-body">
        <ul class="list-group">
          {% if database %}
          <li id="database" data-url="{{ database }}" class="list-group-item"><i class="fa fa-clock-o"></i>&nbsp; {{ text_database }}</li>
          {% else %}
          <li id="database" class="list-group-item text-success"><i class="fa fa-check-circle"></i>&nbsp; {{ text_database }}</li>
          {% endif %}
          
          {# {% if startup %}
          <li id="startup" data-url="{{ startup }}" class="list-group-item"><i class="fa fa-clock-o"></i>&nbsp; {{ text_startup }}</li>
          {% else %}
          <li id="startup" class="list-group-item text-success"><i class="fa fa-check-circle"></i>&nbsp; {{ text_startup }}</li>
          {% endif %} #}
          
          {# {% if event %}
          <li id="event" data-url="{{ event }}" class="list-group-item"><i class="fa fa-clock-o"></i>&nbsp; {{ text_event }}</li>
          {% else %}
          <li id="event" class="list-group-item text-success"><i class="fa fa-check-circle"></i>&nbsp; {{ text_event }}</li>
          {% endif %} #}
          
          {% if modification %}
          <li id="modification" data-url="{{ modification }}" class="list-group-item"><i class="fa fa-clock-o"></i>&nbsp; {{ text_modification }}</li>
          {% else %}
          <li id="modification" class="list-group-item text-success"><i class="fa fa-check-circle"></i>&nbsp; {{ text_modification }}</li>
          {% endif %}

          {% if hook %}
          <li id="hook" data-url="{{ hook }}" class="list-group-item"><i class="fa fa-clock-o"></i>&nbsp; {{ text_hook }}</li>
          {% else %}
          <li id="hook" class="list-group-item text-success"><i class="fa fa-check-circle"></i>&nbsp; {{ text_hook }}</li>
          {% endif %}
          
          {% if setting %}
          <li id="setting" data-url="{{ setting }}" class="list-group-item"><i class="fa fa-clock-o"></i>&nbsp; {{ text_setting }}</li>
          {% else %}
          <li id="setting" class="list-group-item text-success"><i class="fa fa-check-circle"></i>&nbsp; {{ text_setting }}</li>
          {% endif %}

          {% if patch %}
          <li id="patch" data-url="{{ patch }}" class="list-group-item"><i class="fa fa-clock-o"></i>&nbsp; {{ text_patch }}</li>
          {% endif %}
          
          <li id="complete" data-url="{{ complete }}" class="list-group-item"><i class="fa fa-clock-o"></i>&nbsp; {{ text_complete }}</li>
       </ul>
        <button id="button-install" type="button" class="btn btn-primary" data-loading="{{ text_loading }}">{{ button_install }}</button>
        <a href="{{ continue }}" id="button-continue" class="btn btn-primary hide"><i class="fa fa-arrow-right"></i> {{ button_continue }}</a>
      </div>
    </div>
  </div>
<script>
$('#button-install').on('click', sendRequest);

function sendRequest(){
  var _ctx = $('[data-url]').first();
  var next = false;

  $.ajax({
    url: _ctx.data('url'),
    dataType: 'json',
    cache: false,
    contentType: false,
    processData: false,
    beforeSend: function() {
      $('.alert-dismissible').remove();
      $('#button-install').button('loading');
      _ctx.find('.fa').attr('class', 'fa fa-cog fa-spin');
    },
    complete: function() {
      $('#button-install').button('reset');

      if (next) {
        _ctx.data('url', null).removeAttr('data-url');
        sendRequest();
      }
    },
    success: function(json) {
      if (json['error']) {
          $('#content > .container-fluid').prepend('<div class="alert alert-danger alert-dismissible"><i class="fa fa-exclamation-circle"></i> ' + json['error'] + ' <button type="button" class="close" data-dismiss="alert">&times;</button></div>');
      }

      if (json['success']) {
          $('#content > .container-fluid').prepend('<div class="alert alert-success alert-dismissible"><i class="fa fa-check-circle"></i> ' + json['success'] + ' <button type="button" class="close" data-dismiss="alert">&times;</button></div>');
          $('#button-install').addClass('hide');
          $('#button-continue').removeClass('hide');
      }
      
      if(json['success'] || json['next']){
          _ctx.addClass('text-success');
          _ctx.find('.fa').attr('class', 'fa fa-check-circle');
      }

      if (json['next']) {
          next = true;
      }
    },
    error: function(xhr, ajaxOptions, thrownError) {
      alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
    }
  });
}
</script>
</div>
{{ footer }}
